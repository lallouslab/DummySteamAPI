image: registry.git.bitmycode.com:443/bmc/buildingtoolscontainer/master:c837e167a18ba02696ea2e641b78cc92fb89080d

.build-targets-common: &build-targets-common
  stage: build-targets
  variables:
    MAKE_TGT: ''
  script:
    - eval make defconfig
    - eval make $MAKE_TGT

stages:
    - build-targets

.build-linux-targets-common: &build-linux-targets-common
  <<: *build-targets-common
  artifacts:
    paths:
      - out/libsteam_api.so

build-linux-i686:
  <<: *build-linux-targets-common
  variables:
    MAKE_TGT: 'all OS=linux CC=x86_64-linux-gnu-gcc CFLAGS=-m32 LDFLAGS=-m32'

build-linux-x86_64:
  <<: *build-linux-targets-common
  variables:
    MAKE_TGT: 'all OS=linux CC=x86_64-linux-gnu-gcc'

.build-windows-targets-common: &build-windows-targets-common
  <<: *build-targets-common
  artifacts:
    paths:
      - out/libsteam_api.dll

build-windows-i686:
  <<: *build-windows-targets-common
  variables:
    MAKE_TGT: 'OS=windows CC=i686-w64-mingw32-gcc'

build-windows-x86_64:
  <<: *build-windows-targets-common
  variables:
    MAKE_TGT: 'OS=windows CC=x86_64-w64-mingw32-gcc'
